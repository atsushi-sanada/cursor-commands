# Cursor プロジェクト初期セットアップ自動化ワークフロー

このワークフローは、Cursorプロジェクトの基本構造を作成し、AGENTS.mdと.cursor/rules/を順次セットアップします。

## 📋 クイックリファレンス

### 実行フロー（3ステップ）
1. **ステップ1**: プロジェクト構造作成 → 完了確認 → ユーザー承認待ち
2. **ステップ2**: Project Visionヒアリング → AGENTS.md生成（思想のみ） → 完了確認（手順8） → ユーザー承認待ち
3. **ステップ3**: ルールファイル提案 → ユーザー承認 → ファイル作成

### ⚠️ 重要な禁止事項（必ず守る）
- ❌ **完了確認をスキップして次のステップに進む**（手順8を必ず実行）
- ❌ **ユーザーの確認なしにファイルを作成する**
- ❌ **AGENTS.mdに具体的なルールを記載する**（思想・価値観のみ）

### 各ステップの重要ポイント
- **ステップ1**: フォルダ構造のみ作成、AGENTS.mdは空ファイル
- **ステップ2**: Project Visionのみヒアリング、思想のみ生成、完了確認必須（手順8）
- **ステップ3**: サマリ提案必須、ユーザー承認後に作成

### AGENTS.mdとrulesの書き分け
- **AGENTS.md**: 「なぜ」という思想・価値観のみ（30行以内）
- **rules**: 「どう」という具体的な手順・形式

---

## ⚠️ 重要な注意事項

**このワークフローは段階的に実行し、各ステップの完了時に必ずユーザーの確認を求めてください。**
- ユーザーの確認なしに次のステップに進まない
- ステップ2: Project Visionのヒアリング必須
- ステップ3: サマリ提案必須、ユーザー承認後に作成

## ワークフロー概要

3ステップを順次実行し、各ステップの完了時にユーザーの確認を求める：

1. **プロジェクト構造の作成** - フォルダ構造とAGENTS.md（空ファイル）を作成
2. **AGENTS.mdの作成** - Project Visionヒアリング → 思想のみを生成 → 完了確認
3. **.cursor/rules/の作成** - ルールファイル提案 → ユーザー承認 → ファイル作成

---

## ステップ1: プロジェクト構造の作成

以下のフォルダ構造を作成します：

```
project-root/
├ .cursor/
│   └ rules/
├ docs/
└ AGENTS.md
```

### 実行手順

1. `.cursor/rules/` ディレクトリが存在しない場合は作成する
2. `docs/` ディレクトリが存在しない場合は作成する
3. `AGENTS.md` が存在しない場合は空のファイルを作成する（既存の場合は上書きしない）

### 実行指示

このステップを実行する際は、以下のコマンドを実行してください：

```bash
# ディレクトリの作成
mkdir -p .cursor/rules
mkdir -p docs/team docs/policies docs/ai-generated

# AGENTS.mdが存在しない場合のみ作成
if [ ! -f AGENTS.md ]; then
  touch AGENTS.md
fi
```

または、ファイル操作ツールを使用して構造を作成してください。

### 完了確認

構造作成が完了したら、**必ず以下のメッセージを表示し、ユーザーの確認を待ってください**：

```
✅ ステップ1: プロジェクト構造の作成が完了しました。

作成された構造:
- .cursor/rules/
- docs/ (team/, policies/, ai-generated/)
- AGENTS.md

次のステップ（AGENTS.mdの作成）に進みますか？
- yes: ステップ2を開始します
- no: ここで終了します
```

**重要**: ユーザーが「yes」と回答するまで、次のステップに進まないでください。

---

## ステップ2: AGENTS.mdの作成

### ヒアリング項目

**Project Vision（プロジェクトのビジョン）のみ**をヒアリングします。**必ずAGENTS.mdのテンプレート（@AGENTS.md）を参照してください。**

#### Project Vision（プロジェクトのビジョン）
- **質問**: 「このプロジェクトが目指すゴールを1〜3行で教えてください。」
- **目的**: プロジェクトの最終的な目標を明確にする

### ヒアリング手順

**⚠️ 重要: このステップでは必ずユーザーに質問し、回答を待ってから次のステップに進んでください。**

1. **ステップ開始の明示**
   - 「ステップ2: AGENTS.mdの作成を開始します。Project Visionについて質問します。」と明示

2. **Project Visionの質問を表示**
   - 「このプロジェクトが目指すゴールを1〜3行で教えてください。」と質問
   - **必ずユーザーの回答を待ってください**（自動で進めない）

3. **回答内容を確認**
   - 回答が不明確な場合は、具体例を提示して補足質問
   - 回答が得られたら次のステップ（AIによる自動生成）へ

### AIによる自動生成手順

**⚠️ 重要: 手順7でAGENTS.mdを保存した後、必ず手順8の完了確認メッセージを表示し、ユーザーの確認を待ってから次のステップに進んでください。完了確認をスキップしてステップ3に進むことは禁止です。**

Project Visionの回答を得たら、以下の手順でAIが2～5のセクションを自動生成します：

1. **@rulesを参照（思想の抽出のみ）**
   - **必ず@rulesを参照してください**
   - **重要**: @rulesに記載されている具体的なルール（命名規則、フォルダ構造、コードテンプレートなど）は参照しない
   - @rulesに記載されているルールの「背後にある思想・価値観」を抽出する
   - 例：「PascalCaseを使う」というルール → 「一貫性と可読性を重視する」という思想を抽出
   - 例：「src/features/**に機能を配置する」というルール → 「機能の独立性を重視する」という思想を抽出

2. **Project Visionを分析**
   - ユーザーが提供したProject Visionの内容を分析
   - プロジェクトの性質を推測：
     - **コーディングプロジェクト**: ゲーム開発、Web開発、Unity、Python、JavaScript、C#、GASなど
     - **文書作成プロジェクト**: 技術文書、ブログ、マニュアル、翻訳、多言語対応など
     - **その他**: デザイン、データ分析、研究など

3. **2～5のセクションを自動生成（思想のみ）**
   - **Core Principles**: Project Visionから導かれる優先順位、ユーザー体験の基本方針、設計上の思想を生成
   - **Architecture Philosophy**: Project Visionから導かれる「なぜその構造が重要なのか」という価値観を生成（具体的な構造は記載しない）
   - **Documentation Policy**: Project Visionから導かれる「なぜ一貫性が重要なのか」という思想を生成（具体的な記法は記載しない）
   - **Development Mindset**: Project Visionから導かれる「なぜその開発方針が重要なのか」という価値観を生成（具体的な命名規則は記載しない）

4. **生成方針（重要: 思想のみ、簡潔さを重視）**
   - **AGENTS.mdに書くべき内容の判断基準**:
     - 「なぜそうするのか」という思想・価値観 → AGENTS.mdに記載
     - 「どうするのか」という具体的な手順・形式 → rules（.cursor/rules/*.mdc）に記載
     - 例: ❌ AGENTS.mdに書くべきでない「変数名はcamelCaseを使う」
     - 例: ✅ AGENTS.mdに書くべき「コードの可読性を最優先し、一貫性を重視する」
   - **テンプレート項目を必ず含める**: 以下の5つのセクションを必ず含めてください
     - Project Vision（ユーザーの回答）
     - Core Principles（優先順位、ユーザー体験の基本方針、設計上の思想）
     - Architecture Philosophy（ディレクトリ構成の思想、責務分離の方針、データ・状態管理の基本思想）
     - Documentation Policy（ドキュメントの一貫性、AIが作るドキュメントの扱い方の方針）
     - Development Mindset（過度な複雑化を避ける、名前は読みやすく役割が明確、機能追加時の基本スタンス）
   - **テンプレート形式に従う**: @AGENTS.mdのテンプレート構造を必ず遵守してください
   - **思想のみを記述**: 各セクションは「なぜ」という価値観・思想のみを記述し、「どう」という具体的な手順は含めない
   - **簡潔に記述**: 各セクションは要点を絞り、1項目あたり1〜3行程度に収める
   - **箇条書きを優先**: 長文の説明は避け、箇条書きで要点を明確に
   - **判断基準は1行**: 判断基準は1行で簡潔に記述（例：「AIが理解しやすいか？」）
   - **重複を避ける**: 同じ内容を複数のセクションで繰り返さない
   - **全体で30行以内を目安**: AGENTS.md全体が30行程度になるよう調整（Project Visionを含む）
   - Project Visionから導かれる思想を優先的に反映
   - Project Visionと整合性が取れるように調整

5. **プレビューを表示**
   - 生成したAGENTS.mdの全体をプレビューとして表示
   - **行数を確認**: 全体が30行以内になっているか確認し、超過している場合は簡潔化を提案
   - **思想のみか確認**: 具体的なルール（命名規則、フォルダ構造など）が含まれていないか確認し、含まれている場合は思想のみに修正
   - 「以下の内容でAGENTS.mdを作成します。全体で[行数]行です。修正があれば教えてください。」と確認を求める

6. **ユーザーの確認と修正**
   - ユーザーから修正指示があれば反映
   - 修正後の内容を再度確認
   - 確認が取れるまで繰り返す

7. **確認が取れたらAGENTS.mdを保存**
   - プロジェクトルートにAGENTS.mdとして保存

8. **完了確認メッセージを表示し、ユーザーの確認を待つ（必須）**
   - **⚠️ 重要**: このステップを必ず実行してください。スキップして次のステップに進まないでください
   - 以下のメッセージを表示:
     ```
     ✅ ステップ2: AGENTS.mdの作成が完了しました。
     
     作成されたファイル:
     - AGENTS.md
     
     次のステップ（.cursor/rules/の作成）に進みますか？
     - yes: ステップ3を開始します
     - no: ここで終了します
     ```
   - **必ずユーザーの回答を待ってください**（自動で次のステップに進まない）
   - ユーザーが「yes」と回答するまで、ステップ3に進まないでください

### AGENTS.mdテンプレート

```markdown
# Project Vision
- [ユーザーの回答を記述。1〜3行程度]

# Core Principles
- 優先順位（例：読みやすさ > パフォーマンス）: [AIがProject Visionから導かれる価値観を1行で記述。具体的なルールは記載しない]
- ユーザー体験の基本方針: [AIがProject Visionから導かれる「なぜその体験が重要なのか」という思想を1〜2行で記述]
- 設計上の思想: [AIがProject Visionから導かれる「なぜその設計が重要なのか」という価値観を1〜2行で記述]

# Architecture Philosophy
- ディレクトリ構成の思想: [AIがProject Visionから導かれる「なぜその構造が重要なのか」という価値観を1行で記述。具体的な構造（例：src/features/**）は記載しない]
- 責務分離の方針: [AIがProject Visionから導かれる「なぜ責務分離が重要なのか」という思想を1行で記述]
- データ・状態管理の基本思想: [AIがProject Visionから導かれる「なぜその管理方法が重要なのか」という価値観を1行で記述]

# Documentation Policy
- ドキュメントの一貫性をどう保つか: [AIがProject Visionから導かれる「なぜ一貫性が重要なのか」という思想を1行で記述。具体的な記法（例：Markdownの見出し階層）は記載しない]
- AI が作るドキュメントの扱い方の方針: [AIがProject Visionから導かれる「なぜその扱い方が重要なのか」という価値観を1行で記述。具体的なパスは記載しない]

# Development Mindset
- 過度な複雑化を避ける: [AIがProject Visionから導かれる「なぜシンプルさが重要なのか」という思想を1行で記述]
- 名前は読みやすく、役割が明確に伝わるもの: [AIがProject Visionから導かれる「なぜ可読性が重要なのか」という価値観を1行で記述。具体的な命名規則（例：camelCase）は記載しない]
- 機能追加時の基本スタンス: [AIがProject Visionから導かれる「なぜそのスタンスが重要なのか」という思想を1行で記述]
```

**重要**: 
- テンプレート項目を必ず含める（5セクション: Project Vision、Core Principles、Architecture Philosophy、Documentation Policy、Development Mindset）
- 思想のみを記述（「なぜ」のみ、「どう」は記載しない）
- 全体で30行以内を目安
- 詳細は「生成方針（手順4）」を参照

---

## ステップ3: .cursor/rules/の作成

### サマリ提案の作成

**重要**: AGENTS.mdの内容と、@rulesを参照して、必要なルールファイルを提案してください。

#### 提案の観点

**プロジェクトタイプに応じて、以下の観点から必要なルールを判断してください：**

1. **コード規約系**（コーディングプロジェクトの場合）
   - 使用言語に応じたコーディング規約（C#, Python, JavaScript, Unity C#, GAS など）
   - 命名規則
   - フォーマット規則

2. **文書作成規約系**（文書作成プロジェクトの場合）
   - Markdown記法ルール
   - 文書構造ルール（見出し階層、セクション構成など）
   - スタイルガイド（表記統一、用語集など）
   - 引用・参考文献のルール
   - 画像・図表の扱い方
   - 翻訳・多言語対応の方針

3. **プロジェクト構造系**
   - フォルダ構成ルール
   - ファイル命名規則
   - 1機能のフォルダ構成・クラス構成ルール（コーディングプロジェクトの場合）
   - 文書の分類・整理ルール（文書作成プロジェクトの場合）

4. **開発プロセス系**
   - Gitコミットメッセージルール
   - ドキュメント作成ルール（Markdown記法など）
   - テスト方針（コーディングプロジェクトの場合）
   - レビュープロセス（文書作成プロジェクトの場合）

5. **品質管理系**
   - AI応答ガバナンス（提案の正確性、ファクトチェック）
   - エラーハンドリング方針（コーディングプロジェクトの場合）
   - ログ出力方針（コーディングプロジェクトの場合）
   - 文書品質チェック方針（文書作成プロジェクトの場合）

### 提案フォーマット

**プロジェクトタイプに応じて、適切なカテゴリのルールを提案してください。**

以下の形式でサマリを表示します：

```
📋 .cursor/rules/に作成するルールファイルの提案

【カテゴリ名】（例：コード規約系、文書作成規約系、プロジェクト構造系など）
1. [ファイル名].mdc
   - 内容: [ルールの概要]
   - 適用範囲: [globパターン]
   - 理由: AGENTS.mdの「[セクション名]」を実現するため

2. [ファイル名].mdc
   - 内容: [ルールの概要]
   - 適用範囲: [globパターン]
   - 理由: [理由を記載]

---
合計: [N]個のルールファイルを作成予定

この提案で進めますか？ (yes/no)
- yes: 提案通りに作成します
- no: 修正や追加の希望を教えてください
```

**重要**: Project Visionの内容を分析し、プロジェクトタイプ（コーディング/文書作成/その他）に応じて適切なカテゴリのルールを提案してください。混在するプロジェクトの場合は、両方のカテゴリを含めて提案してください。

### ユーザーとの合意プロセス

**⚠️ 重要: このステップでは必ずサマリを提案し、ユーザーの合意を得てからファイルを作成してください。**

1. **ステップ開始の明示**
   - 「ステップ3: .cursor/rules/の作成を開始します。まず、作成するルールファイルのサマリを提案します。」と明示

2. **サマリを表示**
   - 上記のフォーマットで提案を表示
   - **必ずユーザーの確認を待ってください**（自動でファイルを作成しない）

3. **ユーザーの確認を待つ**
   - 「この提案で進めますか？ (yes/no)」と確認
   - **ユーザーが「yes」と回答するまで、ファイルを作成しないでください**

4. **修正要望があれば反映して再提案**
   - ユーザーが「no」または修正要望を出した場合、内容を修正して再提案
   - 再度確認を求める

5. **合意が取れたらファイル作成へ**
   - 「yes」または合意が取れたら、実際のファイル作成に進む

### ルールファイルの作成

合意が取れたら、各ルールファイルを以下の手順で作成します：

1. **@rulesを参照**
   - 既存の@rulesから該当するルールを参照
   - AGENTS.mdの内容と整合性を確認
   - **@rulesに記載されている内容をそのまま使用してください**

2. **.mdcファイルの形式で作成**
   - 各ファイルは以下のメタ情報を含む：
     ```markdown
     ---
     description: [ルールの説明。AGENTS.mdのどの原則に基づいているかも記載]
     globs:
       - "[適用範囲のglobパターン]"
     alwaysApply: [true/false]
     ---
     
     [ルールの内容]
     ```

3. **ファイル名の命名規則**
   - `kebab-case.mdc` 形式
   - 内容が明確に分かる名前（例: `coding-conventions-csharp.mdc`）

4. **各ファイルの内容**
   - @rulesから該当セクションを抽出
   - AGENTS.mdの原則と整合性を保つ
   - 具体的で実行可能なルールとして記述
   - **@rulesの内容をそのまま転記してください**

### 作成例

各.mdcファイルは以下の形式で作成します：

```markdown
---
description: [ルールの説明。AGENTS.mdのどの原則に基づいているかも記載]
globs:
  - "[適用範囲のglobパターン]"
alwaysApply: [true/false]
---

# [ルール名]

[@rulesの該当ルール内容をそのまま転記]
```

### 完了確認

全てのルールファイルの作成が完了したら、以下のメッセージを表示します：

```
✅ ステップ3: .cursor/rules/の作成が完了しました。

作成されたルールファイル:
- [ファイル名1]
- [ファイル名2]
- ...

🎉 初期セットアップが完了しました！

これで、Cursorを使った安定した開発を開始できます。
```

---

## 使用方法

このワークフローを実行するには、以下のように呼び出します：

```
@project-rule-setup を実行してください
```

または

```
プロジェクトの初期セットアップを開始してください
```

**重要**: 各ステップの完了時に必ずユーザーの確認を求めてください。詳細は「実行時の注意事項」を参照。

---

## エラーハンドリング

- **既存ファイル**: 上書きせずに確認を求める
- **既存フォルダ**: 既存構造を保持し、不足分のみ追加
- **中断時**: 完了したステップまでを保存し、再開時に前回の状態を確認

---

## 実行時の注意事項

1. **段階的な確認（最重要）**: 
   - 各ステップの完了時に必ずユーザーの確認を求める
   - ステップ2完了時: 手順8の完了確認メッセージを必ず表示
   - ユーザーの確認なしに次のステップに進まない

2. **@rulesの参照**: 
   - ステップ2: 思想のみを抽出（具体的なルールは参照しない）
   - ステップ3: @rulesの内容をそのまま使用

3. **AGENTS.mdの整合性**: 
   - ステップ3では、AGENTS.mdの原則に基づいてルールを判断

4. **テンプレートの遵守**: 
   - AGENTS.md: 5セクション必須、思想のみ、30行以内
   - .mdcファイル: メタ情報（description, globs, alwaysApply）必須
