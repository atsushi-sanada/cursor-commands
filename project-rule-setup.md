# Cursor プロジェクト初期セットアップ自動化ワークフロー

このワークフローは、Cursorプロジェクトの基本構造を作成し、AGENTS.mdと.cursor/rules/を順次セットアップします。

## ワークフロー概要

以下の3ステップを順次実行します：

1. **プロジェクト構造の作成** - 必要なフォルダとファイルの初期構造を作成
2. **AGENTS.mdの作成** - プロジェクトの思想・原則を定義するためのヒアリングと作成
3. **.cursor/rules/の作成** - AGENTS.mdに基づいた具体的なルールファイル（.mdc）の提案と作成

---

## ステップ1: プロジェクト構造の作成

### 実行内容

以下のフォルダ構造を作成します：

```
project-root/
├ .cursor/
│   └ rules/
├ docs/
│   ├ team/
│   ├ policies/
│   └ ai-generated/
└ AGENTS.md
```

### 実行手順

1. `.cursor/rules/` ディレクトリが存在しない場合は作成する
2. `docs/` ディレクトリが存在しない場合は作成する
3. `docs/team/`, `docs/policies/`, `docs/ai-generated/` サブディレクトリを作成する
4. `AGENTS.md` が存在しない場合は空のファイルを作成する（既存の場合は上書きしない）

### 実行指示

このステップを実行する際は、以下のコマンドを実行してください：

```bash
# ディレクトリの作成
mkdir -p .cursor/rules
mkdir -p docs/team docs/policies docs/ai-generated

# AGENTS.mdが存在しない場合のみ作成
if [ ! -f AGENTS.md ]; then
  touch AGENTS.md
fi
```

または、ファイル操作ツールを使用して構造を作成してください。

### 完了確認

構造作成が完了したら、以下のメッセージを表示します：

```
✅ プロジェクト構造の作成が完了しました。

作成された構造:
- .cursor/rules/
- docs/ (team/, policies/, ai-generated/)
- AGENTS.md

次のステップ: AGENTS.mdの作成に進みます。
```

---

## ステップ2: AGENTS.mdの作成

### 実行内容

AGENTS.mdを作成するためのヒアリングを開始し、ユーザーの回答に基づいてAGENTS.mdを生成します。

### ヒアリング項目

**Project Vision（プロジェクトのビジョン）のみ**をヒアリングします。**必ずAGENTS.mdのテンプレート（@AGENTS.md）を参照してください。**

#### Project Vision（プロジェクトのビジョン）
- **質問**: 「このプロジェクトが目指すゴールを1〜3行で教えてください。」
- **目的**: プロジェクトの最終的な目標を明確にする

### ヒアリング手順

1. **Project Visionの質問を表示**
   - 「このプロジェクトが目指すゴールを1〜3行で教えてください。」と質問
   - ユーザーの回答を待つ

2. **回答内容を確認**
   - 回答が不明確な場合は、具体例を提示して補足質問
   - 回答が得られたら次のステップへ

### AIによる自動生成手順

Project Visionの回答を得たら、以下の手順でAIが2～5のセクションを自動生成します：

1. **@rulesを参照**
   - **必ず@rulesを参照してください**
   - @rulesに記載されているコーディング規約、フォルダ構成、命名規則、開発方針などを確認

2. **Project Visionを分析**
   - ユーザーが提供したProject Visionの内容を分析
   - プロジェクトの性質を推測：
     - **コーディングプロジェクト**: ゲーム開発、Web開発、Unity、Python、JavaScript、C#、GASなど
     - **文書作成プロジェクト**: 技術文書、ブログ、マニュアル、翻訳、多言語対応など
     - **その他**: デザイン、データ分析、研究など

3. **2～5のセクションを自動生成**
   - **Core Principles**: Project Visionと@rulesに基づいて、優先順位、ユーザー体験の基本方針、設計上の思想を生成
   - **Architecture Philosophy**: @rulesのフォルダ構成ルール、責務分離の方針、データ・状態管理の思想を参照して生成
   - **Documentation Policy**: @rulesのMarkdown記法ルール、ドキュメント作成方針を参照して生成
   - **Development Mindset**: @rulesのコーディング規約、命名規則、開発方針を参照して生成

4. **生成方針**
   - @rulesに記載されている内容を優先的に反映
   - Project Visionと整合性が取れるように調整
   - AGENTS.mdのテンプレート形式に従う
   - 具体的で実行可能な内容にする

5. **プレビューを表示**
   - 生成したAGENTS.mdの全体をプレビューとして表示
   - 「以下の内容でAGENTS.mdを作成します。修正があれば教えてください。」と確認を求める

6. **ユーザーの確認と修正**
   - ユーザーから修正指示があれば反映
   - 修正後の内容を再度確認
   - 確認が取れるまで繰り返す

7. **確認が取れたらAGENTS.mdを保存**
   - プロジェクトルートにAGENTS.mdとして保存

### AGENTS.mdテンプレート

```markdown
# Project Vision
- [ユーザーの回答を記述]

# Core Principles
- 優先順位（例：読みやすさ > パフォーマンス）: [AIがProject Visionと@rulesに基づいて自動生成]
- ユーザー体験の基本方針: [AIがProject Visionと@rulesに基づいて自動生成]
- 設計上の思想: [AIがProject Visionと@rulesに基づいて自動生成]

# Architecture Philosophy
- ディレクトリ構成の思想（具体構造は rules に任せる）: [AIが@rulesのフォルダ構成ルールに基づいて自動生成]
- 責務分離の方針: [AIが@rulesに基づいて自動生成]
- データ・状態管理の基本思想: [AIが@rulesに基づいて自動生成]

# Documentation Policy
- ドキュメントの一貫性をどう保つか: [AIが@rulesのMarkdown記法ルールに基づいて自動生成]
- AI が作るドキュメントの扱い方の方針（具体パスは rules に書く）: [AIが@rulesに基づいて自動生成]

# Development Mindset
- 過度な複雑化を避ける: [AIが@rulesのコーディング規約に基づいて自動生成]
- 名前は読みやすく、役割が明確に伝わるもの: [AIが@rulesの命名規則に基づいて自動生成]
- 機能追加時の基本スタンス: [AIが@rulesの開発方針に基づいて自動生成]
```

**重要**: 
- Project Visionはユーザーの回答をそのまま使用
- 2～5のセクションは、**必ず@rulesを参照して生成**してください
- @rulesに記載されている内容を優先的に反映し、Project Visionと整合性が取れるように調整

### 完了確認

AGENTS.mdの作成が完了したら、以下のメッセージを表示します：

```
✅ AGENTS.mdの作成が完了しました。

次のステップ: .cursor/rules/の作成に進みます。
```

---

## ステップ3: .cursor/rules/の作成

### 実行内容

AGENTS.mdの内容を分析し、必要なルールファイル（.mdc）のサマリを提案し、ユーザーとの合意後に実際のファイルを作成します。

### サマリ提案の作成

**重要**: AGENTS.mdの内容と、@rulesを参照して、必要なルールファイルを提案してください。

#### 提案の観点

**プロジェクトタイプに応じて、以下の観点から必要なルールを判断してください：**

1. **コード規約系**（コーディングプロジェクトの場合）
   - 使用言語に応じたコーディング規約（C#, Python, JavaScript, Unity C#, GAS など）
   - 命名規則
   - フォーマット規則

2. **文書作成規約系**（文書作成プロジェクトの場合）
   - Markdown記法ルール
   - 文書構造ルール（見出し階層、セクション構成など）
   - スタイルガイド（表記統一、用語集など）
   - 引用・参考文献のルール
   - 画像・図表の扱い方
   - 翻訳・多言語対応の方針

3. **プロジェクト構造系**
   - フォルダ構成ルール
   - ファイル命名規則
   - 1機能のフォルダ構成・クラス構成ルール（コーディングプロジェクトの場合）
   - 文書の分類・整理ルール（文書作成プロジェクトの場合）

4. **開発プロセス系**
   - Gitコミットメッセージルール
   - ドキュメント作成ルール（Markdown記法など）
   - テスト方針（コーディングプロジェクトの場合）
   - レビュープロセス（文書作成プロジェクトの場合）

5. **品質管理系**
   - AI応答ガバナンス（提案の正確性、ファクトチェック）
   - エラーハンドリング方針（コーディングプロジェクトの場合）
   - ログ出力方針（コーディングプロジェクトの場合）
   - 文書品質チェック方針（文書作成プロジェクトの場合）

### 提案フォーマット

**プロジェクトタイプに応じて、適切なカテゴリのルールを提案してください。**

以下の形式でサマリを表示します：

#### コーディングプロジェクトの場合の例

```
📋 .cursor/rules/に作成するルールファイルの提案

【コード規約系】
1. coding-conventions-csharp.mdc
   - 内容: C#コーディング規約（命名規則、コメント規約、エラーハンドリング）
   - 適用範囲: **/*.cs
   - 理由: AGENTS.mdの「Core Principles」と「Development Mindset」を実現するため

2. coding-conventions-python.mdc
   - 内容: Pythonコーディング規約（PEP8準拠、型ヒント、Docstring）
   - 適用範囲: **/*.py
   - 理由: [同様に理由を記載]

【プロジェクト構造系】
3. folder-structure.mdc
   - 内容: フォルダ構成ルール、ファイル命名規則
   - 適用範囲: **/*
   - 理由: [理由を記載]

【開発プロセス系】
4. git-commit-messages.mdc
   - 内容: Gitコミットメッセージの形式ルール
   - 適用範囲: 全ファイル
   - 理由: [理由を記載]

【品質管理系】
5. ai-response-governance.mdc
   - 内容: AI応答の正確性、ファクトチェック、是認バイアス排除
   - 適用範囲: 全ファイル
   - 理由: [理由を記載]

---
合計: [N]個のルールファイルを作成予定

この提案で進めますか？ (yes/no)
- yes: 提案通りに作成します
- no: 修正や追加の希望を教えてください
```

#### 文書作成プロジェクトの場合の例

```
📋 .cursor/rules/に作成するルールファイルの提案

【文書作成規約系】
1. markdown-conventions.mdc
   - 内容: Markdown記法ルール（見出し階層、コードブロック、リンク形式など）
   - 適用範囲: **/*.md
   - 理由: AGENTS.mdの「Documentation Policy」を実現するため

2. document-structure.mdc
   - 内容: 文書構造ルール（セクション構成、目次の形式など）
   - 適用範囲: **/*.md
   - 理由: [理由を記載]

3. style-guide.mdc
   - 内容: スタイルガイド（表記統一、用語集、敬語・文体の統一など）
   - 適用範囲: **/*.md
   - 理由: [理由を記載]

【プロジェクト構造系】
4. folder-structure.mdc
   - 内容: フォルダ構成ルール、ファイル命名規則、文書の分類ルール
   - 適用範囲: **/*
   - 理由: [理由を記載]

【開発プロセス系】
5. git-commit-messages.mdc
   - 内容: Gitコミットメッセージの形式ルール
   - 適用範囲: 全ファイル
   - 理由: [理由を記載]

【品質管理系】
6. ai-response-governance.mdc
   - 内容: AI応答の正確性、ファクトチェック、是認バイアス排除
   - 適用範囲: 全ファイル
   - 理由: [理由を記載]

---
合計: [N]個のルールファイルを作成予定

この提案で進めますか？ (yes/no)
- yes: 提案通りに作成します
- no: 修正や追加の希望を教えてください
```

**重要**: Project Visionの内容を分析し、プロジェクトタイプに応じて適切なカテゴリのルールを提案してください。コーディングと文書作成が混在するプロジェクトの場合は、両方のカテゴリを含めて提案してください。

### ユーザーとの合意プロセス

1. **サマリを表示**
   - 上記のフォーマットで提案を表示

2. **ユーザーの確認を待つ**
   - 「この提案で進めますか？」と確認

3. **修正要望があれば反映して再提案**
   - ユーザーが「no」または修正要望を出した場合、内容を修正して再提案

4. **合意が取れたら次のステップへ**
   - 「yes」または合意が取れたら、実際のファイル作成に進む

### ルールファイルの作成

合意が取れたら、各ルールファイルを以下の手順で作成します：

1. **@rulesを参照**
   - 既存の@rulesから該当するルールを参照
   - AGENTS.mdの内容と整合性を確認
   - **@rulesに記載されている内容をそのまま使用してください**

2. **.mdcファイルの形式で作成**
   - 各ファイルは以下のメタ情報を含む：
     ```markdown
     ---
     description: [ルールの説明。AGENTS.mdのどの原則に基づいているかも記載]
     globs:
       - "[適用範囲のglobパターン]"
     alwaysApply: [true/false]
     ---
     
     [ルールの内容]
     ```

3. **ファイル名の命名規則**
   - `kebab-case.mdc` 形式
   - 内容が明確に分かる名前（例: `coding-conventions-csharp.mdc`）

4. **各ファイルの内容**
   - @rulesから該当セクションを抽出
   - AGENTS.mdの原則と整合性を保つ
   - 具体的で実行可能なルールとして記述
   - **@rulesの内容をそのまま転記してください**

### 作成例

#### coding-conventions-csharp.mdc の例

```markdown
---
description: C#コーディング規約。AGENTS.mdの「Core Principles」と「Development Mindset」に基づき、命名規則、コメント規約、エラーハンドリング、ログ出力のルールを定義します。
globs:
  - "**/*.cs"
alwaysApply: false
---

# Unity C# コーディング規約

[@rulesのC#コーディング規約の内容をここにそのまま記述]

## 命名規則
[AGENTS.mdの「Development Mindset」に基づいた命名規則]

## コメント規約
[AGENTS.mdの「Documentation Policy」に基づいたコメント規約]

...
```

### 完了確認

全てのルールファイルの作成が完了したら、以下のメッセージを表示します：

```
✅ .cursor/rules/の作成が完了しました。

作成されたルールファイル:
- [ファイル名1]
- [ファイル名2]
- ...

初期セットアップが完了しました！🎉

これで、Cursorを使った安定した開発を開始できます。
```

---

## エラーハンドリング

### 既存ファイルの扱い

- **既存のAGENTS.md**: 
  - 内容がある場合は、上書きせずに確認を求める
  - 「既存のAGENTS.mdが見つかりました。上書きしますか？それとも既存内容をベースに更新しますか？」

- **既存の.cursor/rules/*.mdc**: 
  - 同名ファイルがある場合は、上書きせずに確認を求める
  - 「[ファイル名]が既に存在します。上書きしますか？スキップしますか？」

- **既存のフォルダ**: 
  - 既存の構造を保持し、不足分のみ追加

### 中断時の対応

- 各ステップの完了時に確認を求める
- 中断された場合は、完了したステップまでを保存
- 再開時は前回の状態を確認してから続行

---

## 実行時の注意事項

1. **@rulesの参照**: 
   - 各ステップで@rulesを必ず参照し、既存のルールと整合性を保つ
   - ステップ3では、@rulesの内容をそのまま使用する

2. **AGENTS.mdの整合性**: 
   - ステップ3では、必ずAGENTS.mdの内容を参照してルールを作成する
   - AGENTS.mdの原則に基づいて、どのルールが必要かを判断する

3. **段階的な確認**: 
   - 各ステップの完了時にユーザーの確認を求める
   - 一度に全てを実行せず、段階的に進める

4. **柔軟な対応**: 
   - ユーザーの要望に応じて、提案を修正・追加できるようにする
   - ユーザーが「このルールは不要」と言った場合は、そのルールを除外する

5. **テンプレートの遵守**: 
   - AGENTS.mdの作成時は、必ず@AGENTS.mdのテンプレート形式に従う
   - .mdcファイルの作成時は、必ずメタ情報（description, globs, alwaysApply）を含める

---

## 使用方法

このワークフローを実行するには、以下のように呼び出します：

```
@project-rule-setup を実行してください
```

または

```
プロジェクトの初期セットアップを開始してください
```

ワークフローは自動的に3ステップを順次実行します。各ステップの完了時に確認を求めるので、段階的に進めることができます。
