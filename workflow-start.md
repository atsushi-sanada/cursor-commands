# タスク実行の 5 段階フロー

## 実行ルール

### github 認証情報

- owner: [Github のオーナ名] # Github MCP を使用するのに必要。定義しないと毎回確認するようになります。

### ファイル操作

- 新規タスク開始時: 既存ファイル、既存 issue の**内容を全て削除して白紙から書き直す** # 既存ファイルが存在する状態で再実行する場合に必要
- ファイル編集前に必ず現在の内容を確認

### フェーズ管理

- 各段階開始時: 「前段階の md ファイルを読み込みました」と報告
- 各段階の最後に、期待通りの結果になっているか確認
- `.cursor_workflow/requirements.md`が存在しない場合は必ず要件定義フェーズから始める

### 実行方針

- 段階的に進める: 一度に全てを変更せず、小さな変更を積み重ねること
- 複数のタスクを同時並行で進めないこと
- エラーが発生した場合は、報告すること
- エラーを解決してから次へ進むこと
- ユーザからの指示に無い機能を勝手に追加しないこと

## 1. 要件定義フェーズ

- ユーザからの指示に対して **「何を作るのか」を明確に定める。**
- 目的の明確化、現状分析、機能要件の定義、非機能要件の定義、制約条件の定義を実行する
- `.cursor_workflow/requirements.md`に文書化
- **必須確認**: 「要件定義フェーズが完了しました。設計フェーズに進んでよろしいですか？」

## 2. 設計フェーズ

- **必ず`.cursor_workflow/requirements.md`を読み込んでから開始すること**
- 要件定義フェーズで決定したことをもとに **「どのようにつくるか」「内部でどのように処理するか」を設計する**
- プログラマーが実際にコーディングできるレベルまで詳細化すること
- `.cursor_workflow/design.md`に文書化
- **必須確認**: 「設計フェーズが完了しました。実装計画フェーズに進んでよろしいですか？」

## 3. 実装計画フェーズ

- **必ず`.cursor_workflow/design.md`を読み込んでから開始すること**
- アジャイル・スクラム開発をすることを前提とする
- タスクを実行可能なユーザーストーリー単位に分解、優先順位を設定する
- **AI の作業見積もり時間を表示する**（人間基準の見積もりは不要）
- `.cursor_workflow/implementations.md`に文書化
- **必須確認**: 「実装計画フェーズが完了しました。issue 作成フェーズに進んでよろしいですか？」
- **重要**: issue 作成フェーズは必須のフェーズとして扱う。「直接実装に進むことも可能です」という選択肢を提示しない

## 4. issue 作成フェーズ

- **必ず`.cursor_workflow/implementations.md`を読み込んでから開始すること**
- **重要**: issue 作成フェーズは必須のフェーズとして扱う。スキップする選択肢を提示しない

### Issue 作成方法の優先順位

1. **GitHub MCP サーバー**: 最初に GitHub MCP サーバーで Issue 作成を試みる
2. **GitHub CLI**: GitHub MCP サーバーが使用できない場合、GitHub CLI（`gh`）で Issue 作成を試みる
   - `gh issue create`コマンドを使用
   - ボディが長い場合は`--body-file`オプションを使用
3. **ローカル記録**: GitHub CLI でも作成できない場合、`.cursor_workflow/issues.md`に Issue の内容を記録する

### Issue 作成の手順

1. GitHub MCP サーバーで Issue 作成を試みる
2. 失敗した場合、GitHub CLI で Issue 作成を試みる
   ```bash
   gh issue create --repo <owner>/<repo> --title "<title>" --body "<body>" --label "<label>"
   ```
3. GitHub CLI でも失敗した場合、`.cursor_workflow/issues.md`に Issue の内容を記録する

### 作成結果の記録

- Issue 作成に成功した場合、`.cursor_workflow/issues.md`に Issue 番号と URL を記録する
- ローカルに記録した場合も、`.cursor_workflow/issues.md`に記録する

- **必須確認**: 「issue 作成フェーズが完了しました。実行フェーズに進んでよろしいですか？」

## 5. 実行フェーズ

- **必ず open になっている issue の一覧を確認してから開始**
- **必ず対応する issue の詳細を確認してから開始**
- **現在のブランチで作業する**（作業ブランチの新規作成は不要）
- 実装完了後に適切な単位でコミットメッセージを作成する
- **必須対応** コミット完了したら報告すること
- **issue が完了したらクローズする**（GitHub MCP → GitHub CLI の順で試行、失敗した場合は `.cursor_workflow/issues.md` にクローズ済みとして記録）
- 次の issue に進む場合も実行フェーズを最初から繰り返すこと
